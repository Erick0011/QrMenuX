{% extends 'admin/base.html' %}

{% block title %}Gestão de Usuários{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Gestão de Usuários</h2>
    <a href="{{ url_for('admin.create_user') }}" class="btn btn-success">
        <i class="bi bi-plus-lg"></i> Criar Usuário
    </a>
</div>

<form method="get" class="mb-3">
    <input type="search" name="search" value="{{ search }}" placeholder="Pesquisar por email ou restaurante" class="form-control" />
</form>

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Restaurante</th>
            <th>Whatsapp</th>
            <th>Email</th>
            <th>Status</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
    {% for user in users %}
        <tr>

            <td>{{ user.restaurant.name if user.restaurant else '---' }}</td>
            <td>{{ user.restaurant.phone }}</td>
            <td>{{ user.restaurant.email }}</td>
            <td>
                {% if user.restaurant and user.restaurant.is_active %}
                    <span class="badge bg-success">Ativo</span>
                {% else %}
                    <span class="badge bg-secondary">Inativo</span>
                {% endif %}
            </td>
            <td>
                <a href="{{ url_for('admin.edit_user', user_id=user.id) }}" class="btn btn-sm btn-primary">
                    <i class="bi bi-pencil"></i> Editar
                </a>
                <a href="{{ url_for('admin.toggle_user_status', user_id=user.id) }}" class="btn btn-sm btn-warning">
                    {% if user.restaurant and user.restaurant.is_active %}
                        <i class="bi bi-slash-circle"></i> Desativar
                    {% else %}
                        <i class="bi bi-check-circle"></i> Ativar
                    {% endif %}
                </a>
                <a href="{{ url_for('admin.delete_user', user_id=user.id) }}" 
                   class="btn btn-sm btn-danger"
                   onclick="return confirm('Tem certeza que deseja eliminar este usuário?');">
                   <i class="bi bi-trash"></i> Eliminar
                </a>
            </td>
        </tr>
    {% else %}
        <tr><td colspan="4">Nenhum usuário encontrado.</td></tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
